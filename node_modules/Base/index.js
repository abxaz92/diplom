var  Resource = require('deployd/lib/resource')
	,util = require('util')
	,internalClient = require('deployd/lib/internal-client');

var dpd;
function Base(name, options) {
    Resource.apply(this, arguments);
}
util.inherits(Base, Resource);
module.exports = Base;

Base.prototype.clientGeneration = true;


Base.prototype.handle = function (ctx, next) {
	try{
	    if(ctx.req && ctx.req.method == 'GET'){
			ctx.done(null, Calculate(50, 0.5, 0, 0.4, 240));
	    } else return next();
	} catch(e){
		console.log(e);
	}
}


function Calculate(width, heig, heigh, shir, marka){
  var h=0;  var r=0;  var t=0;  
  var l=0;  var w=0;  var s=0;  
  var v=0;  var c=0;  var p=0;  
  var g=0;  var m=0;  var k=0;
  var a=0;  var o=0;

  r=heig;
  t=heigh;
  w=width;
  s=shir;
  m=marka;

  h=r+t;
  v=w*h*s;
  c=Math.round(marka*v);
  p=Math.round((v*0.66)+((-m+240)*v/1000));
  g=Math.round(v*1.15);

  k=Math.round(h/0.7)+1;
  a=Math.round(w*k*2+(w/0.5*(2*h+k*(s-0.1))));
  o=Math.round(w*t*5.5)/10;
  
	// icost.innerHTML='<p align=left> Количество бетона '+Math.round(v/1)*1+' м3  </p> <p align=left> ('+c+' кг  цемента,  '+p+' тонн песка  и  '+g+' тонн щебня)</p>  <p align=left>Арматуры '+a+' метр(а)(ов).</p>  <p align=left>  Доски для опалубки (толщина 25 мм.) '+o+' м3</p>';
	return {
		 betonCol : Math.round(v/1)*1
		,cement	: c
		,pesok	: p
		,sheben	: g
		,arm 	: a
	}
}


process.server.on('listening', function() {
  dpd = internalClient.build(process.server);
});


// function Dotmaker(num1){
//   var i=0;

//   i = num1.indexOf(',');
//   if(i!=-1)  {
//     num1 = num1.substring(0,i) + "." + num1.substring(i+1);
//   }
//   num1=parseFloat(num1);
//   return num1;
// }

// 			<select name="marka" size="1" id="marka" align="left" style="width:130px;">
//             <option value="170">М-100</option>
//             <option value="200">М-150</option>
//             <option value="240" selected>М-200</option>
//             <option value="300">М-250</option>
//             <option value="320">М-300</option>
//           </select>

