var  Resource = require('deployd/lib/resource')
	,util = require('util')
	,internalClient = require('deployd/lib/internal-client');

var dpd;
function Concrete(name, options) {
    Resource.apply(this, arguments);
}
util.inherits(Concrete, Resource);
module.exports = Concrete;

Concrete.prototype.clientGeneration = true;


Concrete.prototype.handle = function (ctx, next) {
	try{
	    if(ctx.req && ctx.req.method == 'GET'){
			ctx.done(null, calc(10,1));
	    } else return next();
	} catch(e){
		console.log(e);
	}
}

function calc(V, mark) {
	type = [
		 [220, 780, 0.6, 	1250, 0.8, 180]
		,[280, 740, 0.55, 	1250, 0.8, 180]
		,[320, 700, 0.5, 	1250, 0.8, 180]
		,[380, 630, 0.45, 	1250, 0.8, 180]
	];
	var total 	= V * type[mark][0];
	var total21	= V * type[mark][1];
	var total22	= V * type[mark][2];
	var total31	= V * type[mark][3];
	var total32	= V * type[mark][4];
	var total4 	= V * type[mark][5];

	return {
		 Cement: total.toFixed(2)
		,Pesok : total21.toFixed(2) + 'кг  ' + total22.toFixed(2) + 'м<sup>3</sup>' 
		,Sheben: total31.toFixed(2) + 'кг  ' + total32.toFixed(2) + 'м<sup>3</sup>' 
		,Water : total4.toFixed(2)
	};
}

process.server.on('listening', function() {
  dpd = internalClient.build(process.server);
});