var  Resource = require('deployd/lib/resource')
	,util = require('util')
	,internalClient = require('deployd/lib/internal-client');

var dpd;
function Block(name, options) {
    Resource.apply(this, arguments);
}
util.inherits(Block, Resource);
module.exports = Block;

Block.prototype.clientGeneration = true;


Block.prototype.handle = function (ctx, next) {
	try{
	    if(ctx.req && ctx.req.method == 'GET'){
	    	var bott 	= ctx.query.bott;
	    	var lenght 	= ctx.query.lenght;
	    	var tol_shva= ctx.query.tol_shva;
	    	var brick 	= ctx.query.brick;

				ctx.done(null, calculator(bott, lenght, tol_shva, brick));
	    } else return next();
	} catch(e){
		console.log(e);
	}
}

function calculator(bott, lenght, tol_shva, brick) {
	var N10 = 0;
	var N = 0;
	var K4 = bott;
	var K2 = lenght;
	var K7 = 0;
	var K6 = 0;
	var K8 = 0;
	var K9 = 0;
	var K10 = 0;
	var K11 = 0;
	var K12 = 0.24;
	var K13 = tol_shva;
	var P1 = 0;
	var P2 = 0;
	var P3 = 0;
	var Nam = '';
	if (brick == 1) {
		Nam = 'Кирпич одинарный щелевой';P1 = 0.25;P2 = 0.065;P3 = 0.12;}
	if (brick == 2) {
		Nam = 'Кирпич утолщенный щелевой (полуторный)';P1 = 0.25;P2 = 0.88;P3 = 0.12;}
	if (brick == 3) {
		Nam = 'Кирпич двойной, поризованный 2,1 NF';P1 = 0.25;P2 = 0.138;P3 = 0.12;}
	if (brick == 4) {
		Nam = 'Блок керамический поризованный 4,5NF';P1 = 0.25;P2 = 0.138;P3 = 0.25;}
	if (brick == 5) {
		Nam = 'Блок керамический поризованный 9 NF';P1 = 0.51;P2 = 0.138;P3 = 0.25;}
	if (brick == 6) {
		Nam = 'Блок керамический поризованный 10,7 NF';P1 = 0.38;P2 = 0.219;P3 = 0.25;}
	if (brick == 7) {
		Nam = 'Блок керамический поризованный 14,3 NF';P1 = 0.51;P2 = 0.219;P3 = 0.25;}
	if (brick == 8) {
		Nam = 'Кирпич полнотелый одинарный';P1 = 0.25;P2 = 0.065;P3 = 0.12;}
	if (brick == 9) {
		Nam = 'Кирпич лицевой пустотелый одинарный';P1 = 0.25;P2 = 0.065;P3 = 0.12;}
	if (brick == 10) {
		Nam = 'Кирпич лицевой пустотелый утолщенный';P1 = 0.25;P2 = 0.88;P3 = 0.12;}
	if (brick == 11) {
		Nam = 'Блок газосиликатный 19*29*59';P1 = 0.191;P2 = 0.592;P3 = 0.291;}
	if (brick == 12) {
		Nam = 'Блок газосиликатный 20*29*59';P1 = 0.2;P2 = 0.59;P3 = 0.29;}
	if (brick == 13) {
		Nam = 'Блок газосиликатный 40*25*60';P1 = 0.4;P2 = 0.599;P3 = 0.249;}
	if (brick == 14) {
		Nam = 'Керамзитобетонные блок';P1 = 0.2;P2 = 0.4;P3 = 0.2;}
	if (brick == 15) {
		Nam = 'Керамзитобетонные перегородка';P1 = 0.1;P2 = 0.4;P3 = 0.2;}

	N10 = (parseFloat(P1)+parseFloat(K13))*(parseFloat(P2)+parseFloat(K13))*parseFloat(P3);
	N = ((K2*K4-K6*K7*K8-K9*K10*K11)*parseFloat(K12))/N10;
	N = Math.round(N);
	return	{name : Nam, col:N};
}



process.server.on('listening', function() {
  dpd = internalClient.build(process.server);
});

/*
        <tr align=left>
            <td>Размер кирпича и кладки</td>
            <td><!-- value - расход на 1 м2 --><select id="f1" onchange="changeImage(value)" name="calc[f1]" style="width:220px">
            <option value="56.50" selected="selected">Кирпич одинарный, кладка в 0,5 кирпича, толщина стен - 120 мм</option>
            <option value="114.3">Кирпич одинарный, кладка в 1 кирпич, толщина стен - 250 мм</option>
            <option value="170.8">Кирпич одинарный, кладка в 1,5 кирпича, толщина стен - 380 мм</option>
            <option value="228.6">Кирпич одинарный, кладка в 2 кирпича, толщина стен - 510 мм</option>
            <option value="285.1">Кирпич одинарный, кладка в 2,5 кирпича, толщина стен - 640 мм</option>
            <option value="42.16">Кирпич полуторный, кладка в 0,5 кирпича, толщина стен - 120 мм</option>
            <option value="86.10">Кирпич полуторный, кладка в 1 кирпич, толщина стен - 250 мм</option>
            <option value="128.3">Кирпич полуторный, кладка в 1,5 кирпича, толщина стен - 380 мм</option>
            <option value="172.2">Кирпич полуторный, кладка в 2 кирпича, толщина стен - 510 мм</option>
            <option value="214.4">Кирпич полуторный, кладка в 2,5 кирпича, толщина стен - 640 мм</option>
            <option value="27.10">Камень двойной, кладка в 0,5 кирпича, толщина стен - 120 мм</option>
            <option value="55.20">Камень двойной, кладка в 1 кирпич, толщина стен - 250 мм</option>
            <option value="82.30">Камень двойной, кладка в 1,5 кирпича, толщина стен - 380 мм</option>
            <option value="110.4">Камень двойной, кладка в 2 кирпича, толщина стен - 510 мм</option>
            <option value="137.5">Камень двойной, кладка в 2,5 кирпича, толщина стен - 640 мм</option>
            </select> </td>
        </tr>*/